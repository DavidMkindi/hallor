{% extends "base.html" %}

{% block title %}Upload Event - Social Media App{% endblock %}

{% block content %}
<!-- Add upload-event-page class to body for CSS targeting -->
<script>
// Add upload-event-page class to body element immediately
document.body.classList.add('upload-event-page');

// Modify mobile header for upload event page
let mobileBackButton = null;
let mobileHeaderTitleElement = null;
let isInPreviewMode = false;

document.addEventListener('DOMContentLoaded', function() {
    // Find the mobile header container
    const mobileHeader = document.querySelector('.d-flex.d-sm-none');
    if (mobileHeader) {
        // Clear existing content
        mobileHeader.innerHTML = '';
        
        // Add back button
        mobileBackButton = document.createElement('a');
        mobileBackButton.href = '/events';
        mobileBackButton.className = 'btn btn-link text-body p-1 mobile-back-btn';
        mobileBackButton.innerHTML = '<i class="bi bi-arrow-left fs-4"></i>';
        mobileBackButton.addEventListener('click', function(e) {
            if (isInPreviewMode) {
                e.preventDefault();
                // Trigger back to form if in preview mode
                if (typeof window.goBackToForm === 'function') {
                    window.goBackToForm();
                } else if (typeof goBackToForm === 'function') {
                    goBackToForm();
                }
            }
        });
        mobileHeader.appendChild(mobileBackButton);
        
        // Add create event title
        const titleDiv = document.createElement('div');
        titleDiv.className = 'flex-grow-1 d-flex justify-content-center mobile-create-event-title';
        const titleH5 = document.createElement('h5');
        titleH5.className = 'mb-0 fw-bold text-body';
        titleH5.textContent = 'Create Event';
        titleDiv.appendChild(titleH5);
        mobileHeaderTitleElement = titleH5;
        mobileHeader.appendChild(titleDiv);
        
        // Add spacer for alignment
        const spacer = document.createElement('div');
        spacer.style.width = '45px';
        mobileHeader.appendChild(spacer);
    }
    
    // Hide mobile bottom nav
    const mobileNav = document.getElementById('mobile-bottom-nav');
    if (mobileNav) {
        mobileNav.style.display = 'none';
    }
});
</script>

<div class="container-fluid p-0">
    <div class="row justify-content-center g-0">
        <!-- Main Content Area (Centered) -->
        <div class="col-12 col-lg-8 col-xl-7" id="main-content-area">
            <div class="p-0">
                <!-- Desktop Header -->
                <div class="d-none d-lg-block mb-4" id="desktopHeader">
                    <div class="d-flex align-items-center justify-content-between">
                        <h4 class="mb-0 fw-bold text-body" id="desktopHeaderTitle">Create New Event</h4>
                        <a href="/events" class="btn btn-outline-secondary btn-sm" id="desktopHeaderBackBtn">
                            <i class="bi bi-arrow-left me-2"></i>Back to Events
                        </a>
                    </div>
                </div>

                <!-- Step Indicator -->
                <div class="step-indicator-container mb-4 px-3">
                    <div class="step-indicator">
                        <div class="step active" id="step1">
                            <div class="step-circle">1</div>
                            <span>Details</span>
                        </div>
                        <div class="step-line"></div>
                        <div class="step" id="step2">
                            <div class="step-circle">2</div>
                            <span>Preview</span>
                        </div>
                    </div>
                </div>

                <!-- Event Form View -->
                <div id="eventFormView" class="event-form-view">
                    <div class="px-3 pb-4">
                        <form id="eventForm" enctype="multipart/form-data">
                            <!-- Event Image Upload -->
                            <div class="mb-4">
                                <label class="form-label fw-semibold mb-3">Event Image *</label>
                                <div class="event-image-upload-container">
                                    <div id="imageUploadArea" class="image-upload-area">
                                        <input type="file" id="eventImage" name="image" accept="image/*" class="d-none" required>
                                        <div class="upload-placeholder" id="uploadPlaceholder">
                                            <i class="bi bi-camera-fill fs-1 text-body-secondary mb-2"></i>
                                            <p class="text-body-secondary mb-2">Click to upload event image</p>
                                            <small class="text-body-secondary">PNG, JPG up to 10MB</small>
                                        </div>
                                        <img id="imagePreview" class="uploaded-image d-none" alt="Event preview">
                                        <button type="button" class="btn-remove-image d-none" id="removeImageBtn">
                                            <i class="bi bi-x-lg"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- Event Title -->
                            <div class="mb-3">
                                <label for="eventTitle" class="form-label fw-semibold">Event Title *</label>
                                <input type="text" class="form-control form-control-lg" id="eventTitle" name="title" placeholder="Enter event title" required>
                            </div>

                            <!-- Description -->
                            <div class="mb-3">
                                <label for="eventDescription" class="form-label fw-semibold">Description *</label>
                                <textarea class="form-control" id="eventDescription" name="description" rows="4" placeholder="Describe your event..." required></textarea>
                                <small class="text-body-secondary">Help attendees understand what makes your event special</small>
                            </div>

                            <!-- Date and Time -->
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <label for="eventDate" class="form-label fw-semibold">Date *</label>
                                    <input type="date" class="form-control form-control-lg" id="eventDate" name="date" required>
                                </div>
                                <div class="col-md-6">
                                    <label for="eventTime" class="form-label fw-semibold">Time *</label>
                                    <input type="time" class="form-control form-control-lg" id="eventTime" name="time" required>
                                </div>
                            </div>

                            <!-- Location and Host -->
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <label for="eventLocation" class="form-label fw-semibold">Location *</label>
                                    <input type="text" class="form-control form-control-lg" id="eventLocation" name="location" placeholder="Event location" required>
                                </div>
                                <div class="col-md-6">
                                    <label for="eventHost" class="form-label fw-semibold">Host/Organizer *</label>
                                    <input type="text" class="form-control form-control-lg" id="eventHost" name="host" placeholder="Your name or organization" required>
                                </div>
                            </div>

                            <!-- Category -->
                            <div class="mb-3">
                                <label for="eventCategory" class="form-label fw-semibold">Category *</label>
                                <select class="form-select form-select-lg" id="eventCategory" name="category" required>
                                    <option value="">Select category</option>
                                    <option value="music">Music</option>
                                    <option value="sports">Sports</option>
                                    <option value="food">Food</option>
                                    <option value="art">Art</option>
                                    <option value="tech">Tech</option>
                                    <option value="business">Business</option>
                                    <option value="education">Education</option>
                                    <option value="health">Health</option>
                                    <option value="outdoor">Outdoor</option>
                                    <option value="social">Social</option>
                                    <option value="charity">Charity</option>
                                    <option value="entertainment">Entertainment</option>
                                    <option value="travel">Travel</option>
                                    <option value="fashion">Fashion</option>
                                    <option value="photography">Photography</option>
                                    <option value="gaming">Gaming</option>
                                </select>
                            </div>

                            <input type="hidden" name="created_at" id="eventCreatedAt">
                        </form>

                        <!-- Continue Button -->
                        <div class="mt-4">
                            <button type="button" class="btn btn-primary btn-lg w-100" id="continueToPreviewBtn">
                                Continue to Preview <i class="bi bi-arrow-right ms-2"></i>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Preview View -->
                <div id="previewView" class="preview-view d-none">
                    <div class="preview-container">
                        <!-- Event Preview Card -->
                        <div class="event-preview-card px-3 pt-3 pb-4">
                            <div class="event-preview-image-container">
                                <img id="previewEventImage" alt="Event preview">
                            </div>
                            
                            <!-- Event Info Preview -->
                            <div class="event-preview-info mt-3">
                                <div class="d-flex align-items-center justify-content-between mb-2">
                                    <span class="badge bg-primary text-white" id="previewCategory">
                                        <i class="bi bi-calendar-event me-1"></i>Category
                                    </span>
                                </div>
                                <h3 class="mb-2 fw-bold d-flex align-items-center gap-2" id="previewName">
                                    <span>Event Title</span>
                                    <img src="/static/images/events.png" alt="Event" class="event-badge" style="height: 20px; width: auto;" id="previewEventIcon">
                                </h3>
                                <p class="text-body-secondary mb-2" id="previewHost">Hosted by Host</p>
                                
                                <div class="event-details-grid mb-3">
                                    <div class="detail-item">
                                        <i class="bi bi-calendar3 text-primary fs-5"></i>
                                        <div>
                                            <small class="text-body-secondary d-block">Date</small>
                                            <span class="fw-semibold" id="previewDate">Date</span>
                                        </div>
                                    </div>
                                    <div class="detail-item">
                                        <i class="bi bi-clock text-primary fs-5"></i>
                                        <div>
                                            <small class="text-body-secondary d-block">Time</small>
                                            <span class="fw-semibold" id="previewTime">Time</span>
                                        </div>
                                    </div>
                                    <div class="detail-item">
                                        <i class="bi bi-geo-alt text-primary fs-5"></i>
                                        <div>
                                            <small class="text-body-secondary d-block">Location</small>
                                            <span class="fw-semibold" id="previewLocation">Location</span>
                                        </div>
                                    </div>
                                    <div class="detail-item">
                                        <i class="bi bi-shop text-primary fs-5"></i>
                                        <div>
                                            <small class="text-body-secondary d-block">Category</small>
                                            <span class="fw-semibold" id="previewCategoryText">Category</span>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="preview-description">
                                    <h6 class="fw-semibold mb-2">Description</h6>
                                    <p class="text-body" id="previewDescription">Event description will appear here</p>
                                </div>
                            </div>
                        </div>

                        <!-- Publish Button -->
                        <div class="preview-bottom-bar px-3">
                            <button class="btn btn-primary btn-lg w-100" id="publishEventBtn">
                                <span id="publishBtnText">Create Event</span>
                                <span id="publishBtnSpinner" class="spinner-border spinner-border-sm ms-2 d-none" role="status" aria-hidden="true"></span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
/* Change blue to red on upload event page */
.btn-primary {
    background-color: #dc3545 !important;
    border-color: #dc3545 !important;
}

.btn-primary:hover {
    background-color: #c82333 !important;
    border-color: #bd2130 !important;
}

.btn-primary:focus {
    background-color: #c82333 !important;
    border-color: #bd2130 !important;
    box-shadow: 0 0 0 0.2rem rgba(220, 53, 69, 0.5) !important;
}

.text-primary {
    color: #dc3545 !important;
}

.text-primary:hover {
    color: #c82333 !important;
}

.bg-primary {
    background-color: #dc3545 !important;
}

.badge-new-verification {
    background-color: #000000 !important;
    color: #ffffff !important;
    border-radius: 50px !important;
    padding: 0.25em 0.6em !important;
    font-size: 0.75rem !important;
    font-weight: 600 !important;
    border: none !important;
    display: inline-flex !important;
    align-items: center !important;
    justify-content: center !important;
    min-width: 45px !important;
    height: 24px !important;
}

[data-bs-theme="dark"] .badge-new-verification {
    background-color: #ffffff !important;
    color: #000000 !important;
}

/* Event badge image - make visible in dark mode */
.event-badge {
    height: 20px;
    width: auto;
}

[data-bs-theme="dark"] .event-badge {
    filter: brightness(0) invert(1) !important;
}

[data-bs-theme="light"] .event-badge {
    filter: none !important;
}

.upload-event-page {
    background: var(--bs-body-bg);
    min-height: 100vh;
}

.step-indicator-container {
    display: flex;
    justify-content: center;
}

.step-indicator {
    display: flex;
    align-items: center;
    gap: 12px;
    max-width: 400px;
}

.step {
    display: flex;
    align-items: center;
    gap: 8px;
    color: #999;
    font-size: 14px;
    transition: all 0.3s;
}

.step.active {
    color: #000;
}

[data-bs-theme="dark"] .step {
    color: #666;
}

[data-bs-theme="dark"] .step.active {
    color: #fff;
}

.step-circle {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    background: transparent;
    border: 2px solid #ccc;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    font-size: 14px;
    color: #999;
    transition: all 0.3s;
}

[data-bs-theme="dark"] .step-circle {
    border-color: #666;
    color: #666;
}

.step.active .step-circle {
    background: transparent;
    border-color: #000;
    color: #000;
    box-shadow: none;
}

[data-bs-theme="dark"] .step.active .step-circle {
    border-color: #fff;
    color: #fff;
}

.step-line {
    width: 40px;
    height: 2px;
    background: #ccc;
    transition: all 0.3s;
}

[data-bs-theme="dark"] .step-line {
    background: #666;
}

.step.active + .step-line {
    background: #000;
}

[data-bs-theme="dark"] .step.active + .step-line {
    background: #fff;
}

.event-form-view {
    animation: fadeIn 0.3s ease-in;
}

.preview-view {
    animation: fadeIn 0.3s ease-in;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}

.event-image-upload-container {
    width: 100%;
}

.image-upload-area {
    position: relative;
    width: 100%;
    min-height: 300px;
    border: 2px dashed var(--bs-border-color);
    border-radius: 12px;
    overflow: hidden;
    cursor: pointer;
    transition: all 0.3s;
    background: var(--bs-secondary-bg);
}

.image-upload-area:hover {
    border-color: #667eea;
    background: var(--bs-body-bg);
}

.upload-placeholder {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    height: 300px;
    text-align: center;
    padding: 20px;
}

.uploaded-image {
    width: 100%;
    height: auto;
    max-height: 500px;
    object-fit: contain;
    display: block;
}

.btn-remove-image {
    position: absolute;
    top: 10px;
    right: 10px;
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: rgba(0, 0, 0, 0.7);
    border: none;
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.3s;
    z-index: 10;
}

.btn-remove-image:hover {
    background: rgba(220, 53, 69, 0.9);
    transform: scale(1.1);
}

.form-control-lg, .form-select-lg {
    padding: 12px 16px;
    font-size: 16px;
    border-radius: 8px;
    border: 1px solid var(--bs-border-color);
    transition: all 0.3s;
}

.form-control-lg:focus, .form-select-lg:focus {
    border-color: #667eea;
    box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
}

.preview-container {
    max-width: 100%;
    margin: 0 auto;
}

.event-preview-card {
    padding-bottom: 20px;
}

.event-preview-image-container {
    width: 100%;
    min-height: 300px;
    max-height: 500px;
    border-radius: 12px;
    overflow: hidden;
    background: var(--bs-secondary-bg);
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    margin-bottom: 20px;
}

.event-preview-image-container img {
    width: 100%;
    height: auto;
    max-height: 500px;
    object-fit: contain;
    display: block;
}

.event-preview-info {
    background: var(--bs-body-bg);
}

.event-details-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 15px;
    padding: 15px;
    background: var(--bs-secondary-bg);
    border-radius: 12px;
}

.detail-item {
    display: flex;
    align-items: center;
    gap: 12px;
}

.preview-description {
    padding: 15px;
    background: var(--bs-secondary-bg);
    border-radius: 12px;
}

.preview-bottom-bar {
    padding: 20px 0;
    border-top: 1px solid var(--bs-border-color);
    position: sticky;
    bottom: 0;
    background: var(--bs-body-bg);
    margin-top: 20px;
}

@media (max-width: 768px) {
    .step span {
        display: none;
    }
    
    .step-circle {
        width: 28px;
        height: 28px;
        font-size: 12px;
    }
    
    .step-line {
        width: 30px;
    }
    
    .image-upload-area {
        min-height: 250px;
    }
    
    .upload-placeholder {
        height: 250px;
    }
    
    .event-preview-image-container {
        min-height: 250px;
        max-height: 400px;
    }
    
    .event-preview-image-container img {
        max-height: 400px;
    }
}
</style>

<script>
// Make goBackToForm globally accessible for mobile header
let goBackToForm = null;

document.addEventListener('DOMContentLoaded', function() {
    const eventImage = document.getElementById('eventImage');
    const imageUploadArea = document.getElementById('imageUploadArea');
    const uploadPlaceholder = document.getElementById('uploadPlaceholder');
    const imagePreview = document.getElementById('imagePreview');
    const removeImageBtn = document.getElementById('removeImageBtn');
    const continueToPreviewBtn = document.getElementById('continueToPreviewBtn');
    const eventFormView = document.getElementById('eventFormView');
    const previewView = document.getElementById('previewView');
    const publishEventBtn = document.getElementById('publishEventBtn');
    const eventForm = document.getElementById('eventForm');
    const desktopHeaderTitle = document.getElementById('desktopHeaderTitle');
    const desktopHeaderBackBtn = document.getElementById('desktopHeaderBackBtn');
    const eventDateInput = document.getElementById('eventDate');

    let selectedImageFile = null;
    let imagePreviewUrl = null;

    // Set minimum date to today
    if (eventDateInput) {
        const today = new Date().toISOString().split('T')[0];
        eventDateInput.setAttribute('min', today);
    }

    // Image upload functionality
    imageUploadArea.addEventListener('click', function() {
        if (!imagePreview.classList.contains('d-none')) {
            return; // Don't open file picker if image is already uploaded
        }
        eventImage.click();
    });

    eventImage.addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (file) {
            if (!file.type.startsWith('image/')) {
                alert('Please select a valid image file');
                return;
            }
            
            if (file.size > 10 * 1024 * 1024) {
                alert('Image size should be less than 10MB');
                return;
            }

            selectedImageFile = file;
            const reader = new FileReader();
            reader.onload = function(e) {
                imagePreviewUrl = e.target.result;
                imagePreview.src = imagePreviewUrl;
                imagePreview.classList.remove('d-none');
                uploadPlaceholder.classList.add('d-none');
                removeImageBtn.classList.remove('d-none');
            };
            reader.readAsDataURL(file);
        }
    });

    removeImageBtn.addEventListener('click', function(e) {
        e.stopPropagation();
        selectedImageFile = null;
        imagePreviewUrl = null;
        imagePreview.src = '';
        imagePreview.classList.add('d-none');
        uploadPlaceholder.classList.remove('d-none');
        removeImageBtn.classList.add('d-none');
        eventImage.value = '';
    });

    // Continue to preview
    continueToPreviewBtn.addEventListener('click', function() {
        if (!eventForm.checkValidity()) {
            eventForm.reportValidity();
            return;
        }

        // Validate image
        if (!selectedImageFile) {
            alert('Please upload an event image');
            eventImage.focus();
            return;
        }

        // Update preview
        updatePreview();

        // Switch views
        eventFormView.classList.add('d-none');
        previewView.classList.remove('d-none');

        // Update step indicator
        document.getElementById('step1').classList.remove('active');
        document.getElementById('step2').classList.add('active');

        // Update header to "Preview Event"
        updateHeaderToPreview();
    });

    // Function to update header to preview mode
    function updateHeaderToPreview() {
        isInPreviewMode = true;
        
        // Update desktop header
        if (desktopHeaderTitle) {
            desktopHeaderTitle.textContent = 'Preview Event';
        }
        if (desktopHeaderBackBtn) {
            desktopHeaderBackBtn.innerHTML = '<i class="bi bi-arrow-left me-2"></i>Back';
            desktopHeaderBackBtn.href = '#';
            desktopHeaderBackBtn.onclick = function(e) {
                e.preventDefault();
                goBackToForm();
            };
        }
        
        // Update mobile header
        if (mobileHeaderTitleElement) {
            mobileHeaderTitleElement.textContent = 'Preview Event';
        }
    }

    // Function to update header to form mode
    function updateHeaderToForm() {
        isInPreviewMode = false;
        
        // Update desktop header
        if (desktopHeaderTitle) {
            desktopHeaderTitle.textContent = 'Create New Event';
        }
        if (desktopHeaderBackBtn) {
            desktopHeaderBackBtn.innerHTML = '<i class="bi bi-arrow-left me-2"></i>Back to Events';
            desktopHeaderBackBtn.href = '/events';
            desktopHeaderBackBtn.onclick = null;
        }
        
        // Update mobile header
        if (mobileHeaderTitleElement) {
            mobileHeaderTitleElement.textContent = 'Create Event';
        }
    }

    // Function to go back to form (make it globally accessible)
    goBackToForm = function() {
        previewView.classList.add('d-none');
        eventFormView.classList.remove('d-none');

        // Update step indicator
        document.getElementById('step2').classList.remove('active');
        document.getElementById('step1').classList.add('active');

        // Update header back to form mode
        updateHeaderToForm();
    };
    
    // Make it globally accessible
    window.goBackToForm = goBackToForm;

    // Update preview function
    function updatePreview() {
        const title = document.getElementById('eventTitle').value;
        const description = document.getElementById('eventDescription').value;
        const date = document.getElementById('eventDate').value;
        const time = document.getElementById('eventTime').value;
        const location = document.getElementById('eventLocation').value;
        const category = document.getElementById('eventCategory').value;
        const host = document.getElementById('eventHost').value;

        // Category icon mapping
        const categoryIcons = {
            'music': 'bi-music-note-beamed',
            'sports': 'bi-trophy',
            'food': 'bi-cup-hot',
            'art': 'bi-palette',
            'tech': 'bi-laptop',
            'business': 'bi-briefcase',
            'education': 'bi-book',
            'health': 'bi-heart-pulse',
            'outdoor': 'bi-tree',
            'social': 'bi-people',
            'charity': 'bi-heart',
            'entertainment': 'bi-film',
            'travel': 'bi-geo-alt',
            'fashion': 'bi-bag',
            'photography': 'bi-camera',
            'gaming': 'bi-controller'
        };

        const categoryIcon = categoryIcons[category] || 'bi-calendar-event';
        const categoryText = category ? category.replace('_', ' ').replace(/\b\w/g, l => l.toUpperCase()) : 'Category';

        // Format date
        let formattedDate = date;
        if (date) {
            const dateObj = new Date(date + 'T00:00:00');
            formattedDate = dateObj.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
        }

        // Format time
        let formattedTime = time;
        if (time) {
            const [hours, minutes] = time.split(':');
            const hour12 = parseInt(hours) % 12 || 12;
            const ampm = parseInt(hours) >= 12 ? 'PM' : 'AM';
            formattedTime = `${hour12}:${minutes} ${ampm}`;
        }

        document.getElementById('previewEventImage').src = imagePreviewUrl;
        const previewNameElement = document.getElementById('previewName');
        const nameSpan = previewNameElement.querySelector('span');
        if (nameSpan) {
            nameSpan.textContent = title;
        } else {
            previewNameElement.innerHTML = `<span>${title}</span><img src="/static/images/events.png" alt="Event" class="event-badge" style="height: 20px; width: auto;" id="previewEventIcon">`;
        }
        document.getElementById('previewHost').textContent = 'Hosted by ' + host;
        document.getElementById('previewDate').textContent = formattedDate;
        document.getElementById('previewTime').textContent = formattedTime;
        document.getElementById('previewLocation').textContent = location;
        document.getElementById('previewCategoryText').textContent = categoryText;
        document.getElementById('previewDescription').textContent = description;
        
        const categoryBadge = document.getElementById('previewCategory');
        categoryBadge.innerHTML = `<i class="bi ${categoryIcon} me-1"></i>${categoryText}`;
    }

    // Publish event
    publishEventBtn.addEventListener('click', function() {
        if (!eventForm.checkValidity()) {
            eventForm.reportValidity();
            return;
        }

        // Show loading state
        const publishBtnText = document.getElementById('publishBtnText');
        const publishBtnSpinner = document.getElementById('publishBtnSpinner');
        publishBtnText.textContent = 'Creating...';
        publishBtnSpinner.classList.remove('d-none');
        publishEventBtn.disabled = true;

        // Set created_at to current date
        document.getElementById('eventCreatedAt').value = new Date().toISOString().split('T')[0];

        // Create FormData from form
        const formData = new FormData(eventForm);

        // Submit form
        fetch('/api/events', {
            method: 'POST',
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert('Event created successfully!');
                window.location.href = '/events/' + data.event.id;
            } else {
                alert('Error creating event: ' + (data.error || 'Unknown error'));
                publishBtnText.textContent = 'Create Event';
                publishBtnSpinner.classList.add('d-none');
                publishEventBtn.disabled = false;
            }
        })
        .catch(error => {
            console.error('Error creating event:', error);
            alert('Error creating event. Please try again.');
            publishBtnText.textContent = 'Create Event';
            publishBtnSpinner.classList.add('d-none');
            publishEventBtn.disabled = false;
        });
    });

    // Real-time preview update on input change
    ['eventTitle', 'eventDescription', 'eventDate', 'eventTime', 'eventLocation', 'eventCategory', 'eventHost'].forEach(id => {
        const element = document.getElementById(id);
        if (element) {
            element.addEventListener('input', function() {
                if (!previewView.classList.contains('d-none')) {
                    updatePreview();
                }
            });
            element.addEventListener('change', function() {
                if (!previewView.classList.contains('d-none')) {
                    updatePreview();
                }
            });
        }
    });
});
</script>
{% endblock %}

